name: CI/CD

on: push

jobs:
 build:
    name: Building image
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Buildx
        id: buildx
        uses: docker/setup-buildx-action@v1
        
      - name: DockerHub login
        uses: docker/login-action@v1
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
          
      - name: Build and push
        uses: docker/build-push-action@v2
        with:
          push: true
          tags: chathurani/githubapipollinghandlerv1:1.0.0 
 job1:
    runs-on: ubuntu-latest
    name: build example and deploy to minikube
    steps:
      - uses: actions/checkout@v2 
      - name: Build & Deploy
       
      - name: Debug
        run: |
           ls -al
      - name: Connect to EC2 Instance
        run: |
         ssh -o StrictHostKeyChecking=no -i "MIIEowIBAAKCAQEArZ2RvPRDugOaaMfCSBx0tYvSP/SusJhlOZWbuPrg8G7k10ED
                kSn9Xw+7RXurbtnb7nhZl8tRv+4FlTCrGQeIllzgmiuHukJrtfYF4Lt+2G0meIm4
                Eb9w9nhW89bCkz4rIftAyB8NLISA07gjS+anHCZlhKG6w13eeMpPCt5nNiBEhYk5
                NXSy2GgZvmNBBb3CwNHXKs8WpeCvQ3JeOxPRTqENJJbL3qrz6COd9GjIH+M/9Hli
                uo8CrsUUvpawvAvirzUXbWTOQTXJFPsl1IIwH1Aq25RbEcC+erl/9VBQPFKXBmkU
                /cx6XcJ1IjEgbHqCJilZBbuiWIAeB6YjE9zRDwIDAQABAoIBAQCVmI35OKga4fvs
                iSN4qzxNKjtx7E2R0N537deOXm3v/j2k1FpUfM/bV1zQFC21iHcfVggs6X55WIjq
                8lKbcIhat5C4hwWekpjo4yJRcH1t0y8w8cnvUPvvA+Y4mTZzVUApOauqREc/srSm
                uaWAQzB+6v7Sd+DLcli9z+SnwtdAJMUiaF6TLBR1BbHJ1P4L1DKssRnus8EcT497
                STPeTphEAJFLC3dXAt4heR3qVe99q8hltuj4GkxSRJ9pss7FGYV9ujmMm1o86mMT
                2Rdb94Amo0m758eIw12HaCq3q//Zbz+YOTEG5bz1j2GIYCVN0C3jHL1io3nHbwn1
                NkW1Lt6xAoGBAOSrze4C8K/4VSbshr0vLfwbbOdpoDEVsOuIqiU/eCxRMTJiXWXZ
                feERvelIbVLQf3WVFyu71tyL7KqpDbWKtM9cE6MAZ/5UUYvs21+jRtjxxiEN9fBO
                CQQir7tVP6Rx2P4shvmSKjoGK/FWkCZwzralw4Z14FaITrfsi3QZa6iFAoGBAMJd
                VoDPqGXX0pR0f1Yg/VPNbNAO4LANCGgdf3c10tTOLVyyOhzwoT2mMVbCwjYkzng/
                hrSXnY3ibkoWCGKeIYGiZMK49oHJa2f8rztpYy3qGBg5Ft8bU2J+F71IKy83V/tf
                eCWzpcm75FkXks59cir+8uGEDo7Gtujf6AOnvdGDAoGAS0hkm59MLiLLpezozw/h
                S8abq/QSURabEHAF1A15Ot3gHH5V0VoxHxAAPfUiSMlrrQJQho1ox2Mpn2XYpZPs
                wvfFXzybABgyYKax8mKGyJWQbQFznpGSVlI1GK+QLEtu7P8r0K5WSJQPk3y0KHOr
                GmaoYHQeT17Ay7yMjMRxtSECgYAPCUV95ZKzfkTOM0z+jsLKTuQSHHSJahiyZUXN
                JR7QU7rypt8UChGPQWIjwiFgKuzGJLP5GJmZtmCt3pJ7fpw8+SEuZzy6wahLfSLZ
                R8fib2+5wADi9aw3vGV9wS2GE5P84F/dGs7CkoSR198FlnLUnLCRfbPam8jeryO1
                1K48nQKBgGHbLMokYZ7MR4GxxW/c9F8EeXIu3SWVZ9mIBR99Poz5lF+HujDlCGu9
                Lzb9LVxxoLbMDCnet+JFxYXxaVsU3SC/YnCSOKMmoPvv6mK0fnCX02hFfjE9WFdB
                GaTMrjA1Aqt6jma5VnKSDXyJ0hL0LkgvB+KexFVO+cbCVd5VHcoG" ec2-user@54.166.162.94
         
      - name: Start minikube
        uses: medyagh/setup-minikube@master
      - name: Try the cluster !
        run: kubectl get pods -A
           
   
